<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />

    <meta name="description" content="ECC 加密 椭圆曲线">
    <meta name="viewport" content="width=device-width,inital-scale=1">
    <title>ECC 椭圆曲线加密工具</title>
    <style>
        .submit {
            margin-top: 20px;
            margin-bottom: 20px;
            padding-left: 10px;
            padding-right: 10px;
            width: 100px;
            height: 40px;
            color: white;
            font-size: 20px;
            border-radius: 5px;
            background-color: cornflowerblue;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 40px;
            font-size: 16px;
        }
        .row{
            flex-direction: row;
        }

        .key{
            height: 30px;
            width: 80%;
        }
        .ecbtn{
            width: 80%;
            margin-top: 40px;
        }
        .rb{
            display: inline-flex;
        }

        #msg{
            height: 150px;
            width: 80%;
        }
        #encresult{
            height: 100px;
            width: 80%;
        }
        .desc{
            width: 80%;
            font-size: 18px;
            color: #555555;
            padding-left: 20px;
            padding-top: 20px;
            padding-bottom: 20px;
            padding-right: 20px;

            line-height: 25px;

        }
        .note{
            color: orangered;
            font-weight: 600;

        }
        a{
            font-style:italic;
            font-weight: 500;
            letter-spacing: 2px;
        }


        @keyframes ascale
        {
            from {transform: scale(1.0)}
            to {transform: scale(1.3);}
			
        }
        .scale
        {
            animation: ascale 0.3s linear  infinite alternate;
            -webkit-animation: ascale 0.3s linear  infinite alternate ;
        }

        .note{
            font-size: 13px;
            color: coral;
        }
    </style>


 
</head>
<body>
    <script type="text/javascript" src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>

    
    <div class="desc">
        
            <a href='https://zh.wikipedia.org/wiki/%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E5%AF%86%E7%A0%81%E5%AD%A6'>ECC(Elliptic Curve Cryptography)</a>椭圆曲线加密,公钥用来加密,私用用来解密,公钥加密的数据有且只能用私钥解密,公钥无法解密。
            <br>ECC的主要优势是它相比RSA加密算法使用较小的密钥长度并提供相当等级的安全性, 256 位的 ECC加密,破解难度等效于2048位密钥的RSA加密
            <p>
            本网站生成的加密曲线参数
            secp256k1 curve, only SHA-512 (KDF), HMAC-SHA-256 (HMAC) and AES-256-CBC ;

            <br>
            加密过程说明,
            <br>
            <br>1.随机生成aes256密钥 skey ,和 初始向量iv, 加密数据m 获得加密数据cipher,加密校验码 mac
            <br>2,采用公钥加密key 获得加密后的AES密钥 eKey
            <br>3.返回 iv  mac eKey  cipher

            <p>
            <br> 加密结果的结构  
            <br> 0-1字节 目前都是0 2-3字节表示 iv 字段的长度, 4-5字节表示校验位的长度, 6-7 随机加密后aes密钥的长度 ,6-9  
            <br>8 字节以后后面依次是 iv, mac校验位,加密后的aes 可以长度,加密后的数据

            <p>
            <text class="note">由于前8个字节表示的是结构信息,都是一样的(0000    0010    0020    0041),所以加密前几个字母是一样的 AAAQACAAQQ</text>
            <br>不要惊慌。
            
         
    </div>
     
    <div class="row">
        <div class="submit" id="genkeypair">重新生成密钥对 </div>
        <text class="note">注:重新生成后, 旧有密文没有对应密钥不能解密。</text>
        
    </div>
    
    <p>
    <div class="row">
        <text>公钥</text>
        <input class="key" id="pubkey" ></input>
    </div>

    <div class="row">
        <text>私钥</text>
        <input class="key" id='prikey' ></input>
    </div>
    
    <div class="row ecbtn">
        <div class="submit rb" id="enc">加密</div>
        <div class="rb" style="width: 50px; ;"></div>
        <div class="submit rb scale" id="dec">解密</div>
    </div>
    
    <div style="margin-top: 20px;">密文</div>
    <textarea id='encresult' placeholder="密文" autocomplete="off"></textarea>
    
    <div style="margin-top: 20px;">明文</div>
    <textarea id='msg' placeholder="明文" autocomplete="off" ></textarea>
    <script>
        // 默认的 公钥密钥 
        // BKVtM3AiAwMJ7BogSwQF3fhpyFGER6QqW7EzFEWbF05SQ5d+IuD+yH5qRGrwwj2NjjEV36MpRDc/Xtao5u4Sgsc=
        // j2N7rIVpxCV1mMdQEk66JgSyb5rXK1MdL8h0tU3ytzM

        $("#prikey").val('fPtrf9iBkJTyEuCKbJuAxRoJEZJFOqPueQZ0mtsOC34=');
        $("#pubkey").val('BAjDe3ig3ZKh5xO0+aA5Zuakz2ukRfe0M3Jzg8nVFn/pnmD58qBX5Iwxk/IUNTm6TVZv7MZcXOcx0KzKORTMD4U=');
        var hlm = 'AAAQACAAQQC9oGo+C1sURw+z4ygia8yt3NMV+WGC9rTnT5f1DZisNzzKDPeoMEdejvNbcmdLa5QErdWpluA+RFE34p4oECtqg0Rn07X7o8ciNnfGBjkT7n0nt7XxMzxyqt/QML/udMelQFfiHQ2E9huWfXHf5DqSRNrutMsru0iXXRm2X9ROMRQeU5+rjFc+bp2XDGmonZOhQMYEd3P8arz4e5N4janLGyPp8UNTAnwR8A5hIdRnnjFLRCUmSMRSOTfcmxBDbFOWv7kyNUBnhwYPVeht0CYZaqIqM/jTkcHW0mA7yGKnX8vYD0RLicgQPbpJiYqOCmeXCtC0VqOoJAXYwxo4twVMyw==';
        var defaultmsg = hlm;
        $('#encresult').val(defaultmsg)

        $('#genkeypair').click(function(){
            $.ajax({
                url:  '//lwx01.herokuapp.com/gen_ecc?t='+new Date().getTime(),
                type: 'Get',
                dataType: 'json',
                error:function(e){
			 
                    console.log(e);
                    alert("出错" + JSON.stringify(e));
                },
                success:function(data){
                    $("#prikey").val(data.privatekey);
                    $("#pubkey").val(data.publickey);
                }
            })
        })
        $('#enc').click(function(){

            var key = $("#pubkey").val();
            if(!key){
                alert('请先填写公钥')
                return;
            }

            var msg = $("#msg").val();
            if(!msg){
                alert('请填写需要加密的明文信息')
                return;
            }

            $('#encresult').val('椭圆封印~~');
            $.ajax({
                url:  '//lwx01.herokuapp.com/ecc_enc?',
                // url:  '//127.0.0.1:3001/ecc_enc?',
                type: 'Post',
                dataType: 'json',
                data:{
                    msg:msg,
                    pubkey:key
                },
                error:function(e){
			 
                    console.log(e);
                    alert("出错" + JSON.stringify(e));
                },
                success:function(data){
                    $("#encresult").val(data.enc||data.err);
                }
            })
        })
        
        $('#dec').click(function(){
            $('#dec').removeClass('scale');

            var key = $("#prikey").val();
            if(!key){
                alert('请先填写私钥')
                return;
            }

            var msg = $("#encresult").val();
            if(!msg){
                alert('请填写需要解密的密文')
                return;
            }

            $('#msg').val('椭圆解印 ~~ 解!!');
            $.ajax({
                url:  '//lwx01.herokuapp.com/ecc_dec?',
                // url:  '//127.0.0.1:3001/ecc_dec?',
                type: 'Post',
                dataType: 'json',
                data:{
                    msg:msg,
                    prikey:key
                },
                error:function(e){
                    console.log(e);
                    alert("出错" + JSON.stringify(e));
                },
                success:function(data){
                    $("#msg").val(data.dec||data.err);
                }
            })
        });
        
    </script>
    
    

    <link rel="stylesheet" href="psgmsg.css">
    <script type="text/javascript" src="postmsg.js?v=2"></script>
    <script src="//gist.github.com/vitock/33ea1af1f69af05d57b763bdf3cc6964.js"></script>
   
</body>
</html>